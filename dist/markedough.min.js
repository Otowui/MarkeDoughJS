class MarkeDough{static initializedForms=new Map;constructor(e,t,o,i={}){this.mktoDomain=e,this.mktoID=t,this.formID=o,this.options=i,this.form=null}static init(e,t,o,i={}){let s=`${e}-${t}-${o}`;if(window.__otoFormsLoaded?.has(s)){i.debug&&console.warn(`‚ö†Ô∏è MarkeDough: Form ${o} is already initialized. Skipping.`);return}window.__otoFormsLoaded=window.__otoFormsLoaded||new Set,window.__otoFormsLoaded.add(s);let l=new MarkeDough(e,t,o,i);l.init(),MarkeDough.initializedForms.set(s,l)}init(){this.attachMktoEvents()}attachMktoEvents(){if(!window.MktoForms2){console.error("‚ö†Ô∏è MktoForms2 is not available. Retrying..."),setTimeout(()=>this.attachMktoEvents(),500);return}MktoForms2.whenRendered(e=>{this.options.debug&&console.debug(`‚úÖ Form ${this.formID} is rendered.`),this.onFormRendered(e)}),MktoForms2.whenReady(e=>{this.options.debug&&console.debug(`‚úÖ Form ${this.formID} is fully loaded.`),this.onFormReady(e)})}onFormRendered(e){this.options.debug&&console.debug(`‚ö°Ô∏è Running onFormRendered() modifications on ${this.formID}.`)}onFormReady(e){this.form=e,this.options.debug&&console.debug(`‚ö°Ô∏è Running onFormReady() modifications on ${this.formID}.`),this.formSubmitting=!1,this.formSubmitted=!1,this.cleanUpMktoElements(e),this.setupCSSReset(e),this.hideSpecifiedElements(e),this.addCssHelpers(e),this.hideLabelsForFields(e),this.processCheckboxOptions(),this.processRadioOptions(),this.replaceTokensInForm(e),this.initCustomLabels(e),this.refactorNumberInputs(e),this.options.dto?this.setupPrefill(e):this.setupUpIntlTelInput(e),this.processUrlParams(e),this.applyTranslations(e),this.setupUploadCare(e),this.executeCustomBehaviorsOnFormReady(e),this.showForm(e),this.setupDeactivation(e),this.options.dataLayerConfig.trackFormReady&&this.pushToDataLayer(this.options.dataLayerConfig.eventName+"Ready"),this.options.clearMunchkin&&this.form.addHiddenFields({_mkt_trk:"",mkt_tok:""}),e.onValidate(t=>{if(this.options.debug&&console.log(`üöÄ Validating form before submission...`),this.formSubmitting){console.warn("‚ö†Ô∏è Preventing duplicate validation.");return}this.formSubmitting=!0,e.submittable(!1);let o=[];if(this.options.intlTelInput&&this.options.intlTelInputFields&&Array.isArray(this.options.intlTelInputFields)){let i=e.getFormElem()[0];this.options.intlTelInputFields.forEach(e=>{let t=i.querySelector(`[name="${e}"]`);if(t&&t.intlTelInputInstance){let o=t.intlTelInputInstance.getNumber();console.debug(`üìû Formatted Phone Number for ${e}: ${o}`),t.value=o}else console.warn(`‚ö†Ô∏è intlTelInput instance not found for: ${e}`)})}this.options.honeypot&&o.push(this.setupHoneypotValidation(e)),this.options.emailVerify&&o.push(this.setupEmailValidation(e)),Promise.all(o).then(t=>{let o=t.every(e=>e);if(!o){console.error("‚õî Validation failed. Submission blocked."),this.formSubmitting=!1;return}console.log(`‚úÖ Final submittable state: true`),e.submittable(!0),setTimeout(()=>{e.getFormElem()[0].checkValidity()?(this.options.debug&&console.log("‚úÖ All validations passed, submitting form..."),e.getFormElem()[0].dispatchEvent(new Event("submit",{bubbles:!0}))):(console.warn("‚ö†Ô∏è Form still invalid, submission blocked."),this.formSubmitting=!1)},100)}).catch(t=>{console.error("‚ö†Ô∏è Validation error:",t),e.submittable(!1),this.formSubmitting=!1})}),e.onSubmit(e=>{this.options.clearMunchkin&&this.form.vals({_mkt_trk:"",mkt_tok:""}),setTimeout(()=>{this.submissionTriggered=!1},500)}),e.onSuccess((t,o)=>{if(this.formSubmitted)return console.warn("‚ö†Ô∏è Preventing duplicate success handling."),!1;if(this.formSubmitted=!0,this.options.debug&&console.log(`üöÄ Form submission successful. Handling follow-up...`),this.executeCustomBehaviorsOnFormSuccess(e),!this.options.followUp)return!0;if(this.options.followUpUrl)return console.log(`üîó Redirecting to follow-up URL: ${this.options.followUpUrl}`),setTimeout(()=>{window.location.href=this.options.followUpUrl},500),!1;if(this.options.followUpMsg){let i=e.getFormElem()[0];i.style.display="none";let s=document.createElement("div");return s.innerHTML=this.options.followUpMsg,i.parentElement.appendChild(s),console.log("Displayed follow-up message instead of redirection."),!1}})}hideForm(e){let t=e.getFormElem()[0];t.style.display="none",this.options.debug&&console.debug(`Form ${this.formID} is now hidden.`)}showForm(e){let t=e.getFormElem()[0];t.style.display="",t.parentElement&&t.parentElement.style.removeProperty("display"),this.options.debug&&console.debug(`Form ${this.formID} is now visible.`)}setupCSSReset(e){if(!this.options.cssReset)return;let t=e.getFormElem()[0];this.removeInlineStyles(t),this.disableMarketoStyles(t),this.removeEmbeddedStyles(t),this.removeMktoHasWidth(t),this.injectStylesheet(),this.options.moreStyles||t.setAttribute("data-style","oto"),this.observeMktoFormStyles(t),this.options.debug&&console.debug(`CSS Reset applied to Form ${this.formID}`)}injectStylesheet(){(this.options.cssStylesheet||this.options.cssStyle||this.options.cssInlineStyle)&&((this.options.cssStyle&&Object.keys(this.options.cssStyle).length>0||this.options.cssInlineStyle&&""!==this.options.cssInlineStyle.trim())&&this.injectCSSVariables(),Array.isArray(this.options.cssStylesheet)&&this.options.cssStylesheet.forEach(e=>{if(!document.querySelector(`link[href="${e}"]`)){let t=document.createElement("link");t.rel="stylesheet",t.href=e,document.head.appendChild(t),this.options.debug&&console.log(`Applied external CSS: ${e}`)}}))}injectCSSVariables(){let e=document.getElementById("otoFormCustomStyles");if(e)return;let t=":root {\n";if(this.options.cssStyle&&Object.keys(this.options.cssStyle).length>0)for(let[o,i]of Object.entries(this.options.cssStyle))t+=`  --otoform-${o}: ${i};
`;t+="}",this.options.cssInlineStyle&&"string"==typeof this.options.cssInlineStyle&&""!==this.options.cssInlineStyle.trim()&&(t+=`
${this.options.cssInlineStyle}`);let s=document.createElement("style");s.id="otoFormCustomStyles",s.textContent=t,document.head.appendChild(s),this.options.debug&&console.log("Injected CSS Variables & Inline Styles:",{variables:this.options.cssStyle,inlineStyles:this.options.cssInlineStyle})}removeEmbeddedStyles(e){let t=e.querySelectorAll("style");t.forEach(e=>e.remove()),this.options.debug&&console.debug(`Removed ${t.length} embedded <style> tags inside the form.`)}removeInlineStyles(e){let t=Array.from(e.querySelectorAll("[style]"));t.forEach(e=>{(!e.closest(".mktoHtmlText")||e.classList.contains("mktoHtmlText"))&&e.removeAttribute("style")}),e.closest(".mktoHtmlText")||e.removeAttribute("style")}removeMktoHasWidth(e){let t=e.querySelectorAll(".mktoHasWidth");e.classList.contains("mktoHasWidth")&&e.classList.remove("mktoHasWidth"),t.forEach(e=>e.classList.remove("mktoHasWidth")),this.options.debug&&console.debug(`Removed .mktoHasWidth from ${t.length+(e.classList.contains("mktoHasWidth")?1:0)} elements.`)}disableMarketoStyles(e){try{let t=Array.from(document.styleSheets);t.forEach(t=>{try{(t.href&&t.href.includes("forms2")||e.contains(t.ownerNode))&&(t.disabled=!0)}catch(o){this.options.debug&&console.warn(`‚ö†Ô∏è Could not access stylesheet:`,o)}})}catch(o){this.options.debug&&console.warn(`‚ö†Ô∏è Error disabling Marketo styles:`,o)}}addCssHelpers(e){if(!this.options.cssReset)return;let t=e.getFormElem()[0];t.querySelectorAll("fieldset").forEach(e=>{let t=e.querySelector("legend");if(!t||!t.textContent.trim())return;let o=this.slugify(t.textContent.trim()),i=e.closest(".mktoFormRow"),s=e.closest(".mktoFormCol");i&&i.classList.add(`otoform-row-fieldset-${o}`),s&&s.classList.add(`otoform-col-fieldset-${o}`),this.options.debug&&console.log(`Added fieldset class "otoform-row-fieldset-${o}"`)}),t.querySelectorAll(".mktoFormRow").forEach(e=>{if(e.querySelector("fieldset"))return;let t=e.querySelectorAll("input, select, textarea"),o=new Set([...t].map(e=>this.slugify(e.name||"")));o.size&&(e.classList.add(`otoform-row-${[...o].join("-")}`),this.options.debug&&console.log(`Added class "otoform-row-${[...o].join("-")}" to row.`))}),t.querySelectorAll(".mktoFormCol").forEach(e=>{if("fieldset"===e.tagName.toLowerCase())return;let t=e.querySelector("input, select, textarea");if(t){let o=this.slugify(t.name||"");o&&(e.classList.add(`otoform-col-${o}`),this.options.debug&&console.log(`Added class "otoform-col-${o}" to column.`))}}),t.querySelectorAll(".mktoFieldWrap").forEach(e=>{let t=e.querySelector("input, select, textarea");if(t){let o=this.slugify(t.name||"");o&&(e.classList.add(`otoform-field-${o}`),this.options.debug&&console.log(`Added class "otoform-field-${o}" to field wrapper.`))}}),t.querySelectorAll(".mktoCheckboxList").forEach(e=>{let t=e.querySelector("input[type='checkbox']");if(t){let o=this.slugify(t.name||"");o&&(e.classList.add(`otoform-checkboxlist-${o}`),this.options.debug&&console.log(`Added class "otoform-checkboxlist-${o}" to checkbox list.`))}}),t.querySelectorAll(".mktoRadioList").forEach(e=>{let t=e.querySelector("input[type='radio']");if(t){let o=this.slugify(t.name||"");o&&(e.classList.add(`otoform-radiolist-${o}`),this.options.debug&&console.log(`Added class "otoform-radiolist-${o}" to radio list.`))}}),t.querySelectorAll(".mktoCheckboxList").forEach(e=>{let t=e.querySelectorAll("label"),o=Array.from(t).some(e=>""===e.textContent.trim()&&""===e.innerHTML.trim());if(o){let i=e.closest(".mktoFieldWrap");i&&(i.classList.add("otoform-single-checkbox"),this.options.debug&&console.log('Added class "otoform-single-checkbox" to field wrap.'))}}),this.options.debug&&console.log("CSS helpers added to form.")}observeMktoFormStyles(e){let t=new MutationObserver(t=>{t.forEach(t=>{"style"===t.attributeName&&e.style.width&&(e.style.removeProperty("width"),this.options.debug&&console.debug("Removed inline width style from .mktoForm"))})});t.observe(e,{attributes:!0,attributeFilter:["style"]}),this.options.debug&&console.debug("MutationObserver started to prevent Marketo from injecting inline width.")}setupUpIntlTelInput(e){var t,o,i,s,l,r;if(!this.options.intlTelInput)return;if("function"!=typeof window.intlTelInput){this.options.debug&&console.error("intlTelInput library not loaded.");return}let n=e.getFormElem()[0],a=this.options.intlTelInputConfig||{},d={initialCountry:a.initialCountry||"auto",strictMode:"1"===(t=a.strictMode)||1===t||!0===t,nationalMode:"1"===(o=a.nationalMode)||1===o||!0===o,geoIpLookup:"1"===(i=a.geoIpLookup)||1===i||!0===i?function(e){fetch(a.geoIpLookupApi||"https://ipinfo.io/json?token=InsertApiKeyHere").then(e=>e.json()).then(t=>{e(t[a.geoIpLookupApiResponseKey]||a.geoIpLookupApiResponseFallback||"us")}).catch(()=>{e(a.geoIpLookupApiResponseFallback||"us")})}:null,allowDropdown:"1"===(s=a.allowDropdown)||1===s||!0===s,showFlags:"1"===(l=a.showFlags)||1===l||!0===l,separateDialCode:"1"===(r=a.separateDialCode)||1===r||!0===r};if(this.options.debug&&console.log("IntlTelInput configuration:",d),this.options.intlTelInputFields&&Array.isArray(this.options.intlTelInputFields)&&this.options.intlTelInputFields.forEach(e=>{let t=n.querySelector(`[name="${e}"]`);t?(t.intlTelInputInstance=window.intlTelInput(t,d),this.options.debug&&console.log(`intlTelInput initialized for field: ${e}`)):this.options.debug&&console.warn(`Field not found for intlTelInput: ${e}`)}),a.CountrySync&&a.CountrySyncSelector){let c=n.querySelector(`[name="${a.CountrySyncSelector}"]`);if(c){let u=window.intlTelInput.getCountryData();c.innerHTML="",u.forEach(e=>{let t=document.createElement("option");t.value=e.iso2,t.text=e.name,c.appendChild(t)});let h=this.options.intlTelInputFields[0],p=n.querySelector(`[name="${h}"]`);if(p&&p.intlTelInputInstance){let m=p.intlTelInputInstance;c.value=m.getSelectedCountryData().iso2,p.addEventListener("countrychange",()=>{c.value=m.getSelectedCountryData().iso2}),c.addEventListener("change",()=>{m.setCountry(c.value)})}}else this.options.debug&&console.warn(`Country Sync Selector element not found: ${a.CountrySyncSelector}`)}}setupUploadCare(e){if(!this.options.uploadCare)return;this.options.debug&&console.log("‚ö°Ô∏è Setting up UploadCare");let t=e.getFormElem()[0];if(this.options.uploadCareTarget){var o,i;let s=this.options.uploadCareTarget,l=(o=this.options.uploadCareConfig,(i=document.createElement("textarea")).innerHTML=o,i.value),r=t.querySelector(`[name="${s}"]`);r.classList.add("oto-visually-hidden");if(r?.closest(".mktoFieldWrap").classList.add("oto-force-space-bottom"),!document.querySelector("uc-file-uploader-minimal")||!document.querySelector("uc-file-uploader-regular")){let n=document.createElement("div");n.classList.add("mktoFormRow"),n.classList.add("otoform-row-uploadcare"),n.innerHTML=`${l}<uc-upload-ctx-provider ctx-name="my-uploader"></uc-upload-ctx-provider>`;let a=t.querySelector(`[name="${s}"]`)?.closest(".mktoFormRow");a?a.insertAdjacentElement("afterend",n):t.insertAdjacentElement("afterend",n)}let d=document.querySelector("uc-upload-ctx-provider[ctx-name='my-uploader']");if(!d){console.error("Uploadcare context provider element not found!");return}d.addEventListener("common-upload-success",e=>{let t=e.detail.successEntries;if(!t||0===t.length)return;let o=t.map(e=>e.cdnUrl);console.log("Files Uploaded:",o),r.value=o.join(", ")})}}setupDeactivation(e){if(!this.options.deactivate)return;let t=e.getFormElem()[0],o=t.parentElement;if(t.style.display="none",this.options.deactivateMessage){let i=document.createElement("div");i.innerHTML=this.options.deactivateMessage,o.appendChild(i)}this.options.debug&&console.debug(`Form ${this.formID} is deactivated and replaced with a message.`)}setupPrefill(e){if(!this.options.dto)return;let t=this.options.dtoSrc,o=this.options.dtoOriginUrl,i=this.options.dtoTargetUrls;if(!t||!o||!i||!Array.isArray(i)){this.options.debug&&console.warn("‚ö†Ô∏è DTO configuration is incomplete. Prefill aborted.");return}this.options.debug&&console.log("Initializing SimpleDTO for form prefill...");let s=new SimpleDTO({debug:this.options.debug,mode:"receive",transport:"message",messageSource:o,messageTarget:i,dataSrc:t,cb:(t,o)=>{this.options.debug&&console.debug("\uD83D\uDDC2Ô∏è Marketo Fields received:",o),e.setValuesCoerced(o),this.onPrefillReadyTriggerLeadActions(e,o),s.cleanup()}})}onPrefillReadyTriggerLeadActions(e,t){this.options.debug&&console.log("‚ö°Ô∏èLead actions triggered after DTO prefill"),this.setupUpIntlTelInput(e),this.executeCustomBehaviorsOnFormPrefill(e),this.options.notYou&&t.Email&&this.setupNotYouButton()}setupEmailValidation(e){return new Promise(t=>{if(!this.options.emailVerify||!this.options.emailVerifyAPI)return t(!0);let o=this.options.emailVerifyAPI,i=o.fieldName||"Email",s=e.getFormElem()[0].querySelector(`[name="${i}"]`);if(!s)return this.options.debug&&console.warn(`‚ö†Ô∏è Email field not found: ${i}`),t(!0);if(!s.value||!s.value.includes("@")||!s.value.includes("."))return this.markInvalid(s,"Invalid email format."),t(!1);let l=this,r=Object.keys(o.action)[0]||"verify",n=o.action[r]||{},a={checkMX:"checkmx",checkCustomBlacklist:"checkblacklist",checkFreeEmails:"checkfreelist",checkDisposableEmails:"checkdisposablelist",checkWhitelist:"checkwhitelist"},d=Object.entries(n).filter(([e,t])=>void 0!==a[e]&&"boolean"==typeof t).map(([e,t])=>`${a[e]}=${t?"true":"false"}`).join("&"),c=`${o.endpoint}?key=${o.hash}&action=${r}&${d}&eml=${encodeURIComponent(s.value)}`,u=new XMLHttpRequest;u.open("GET",c,!0),u.responseType="json",u.onload=function(){if(200===u.status){let o=u.response;if(console.debug(`üöÄ Email Validation API Response: ${JSON.stringify(o,null,2)}`),o&&Array.isArray(o)&&o.length>0){let i=o[0];"1"===i.valid?(e.submittable(!0),l.markValid(s),t(!0)):(console.error(`üö® Invalid Email Detected: ${i.msg}`),e.submittable(!1),l.markInvalid(s,i.msg),t(!1))}else console.error("‚ö†Ô∏è Invalid API response format:",o),t(!0)}else console.error("‚ö†Ô∏è Validation API error:",u.status,u.statusText),t(!0)},u.onerror=function(){console.error("‚ö†Ô∏è Network error during email validation."),t(!0)},u.send()})}validateEmailField(e,t){return new Promise(o=>{if(!e.value||!e.value.includes("@")||!e.value.includes("."))return this.markInvalid(e,"Invalid email format."),t.submittable(!1),o(!1);let i=this,s=this.options.emailVerifyAPI,l=Object.keys(s.action)[0]||"verify",r=s.action[l]||{},n={checkMX:"checkmx",checkCustomBlacklist:"checkblacklist",checkFreeEmails:"checkfreelist",checkDisposableEmails:"checkdisposablelist",checkWhitelist:"checkwhitelist"},a=Object.entries(r).filter(([e,t])=>void 0!==n[e]&&"boolean"==typeof t).map(([e,t])=>`${n[e]}=${t?"true":"false"}`).join("&"),d=`${s.endpoint}?key=${s.hash}&action=${l}&${a}&eml=${encodeURIComponent(e.value)}`,c=new XMLHttpRequest;c.open("GET",d,!0),c.responseType="json",c.onload=function(){if(200===c.status){let s;try{s=c.response}catch(l){return console.error("‚ùå JSON Parsing Error:",l),t.submittable(!1),o(!1)}if(console.debug("\uD83D\uDE80 Email Validation API Response:",JSON.stringify(s,null,2)),s&&Array.isArray(s)&&s.length>0){let r=s[0];"1"===r.valid?(i.markValid(e),t.submittable(!0),o(!0)):(console.warn("\uD83D\uDEA8 Invalid Email Detected:",r.msg),i.markInvalid(e,r.msg||"Please enter a valid company email."),t.submittable(!1),o(!1))}else console.error("‚ùå Unexpected API Response Format:",s),t.submittable(!1),o(!1)}else console.error("‚ùå API Request Failed:",c.status,c.statusText),t.submittable(!1),o(!1)},c.onerror=function(){console.error("‚ùå Network Error During Email Validation."),t.submittable(!1),o(!1)},c.send()})}setupErrorHideEvents(){let e=document.querySelector(".mktoForm");if(!e)return;let t=()=>{let o=e.querySelectorAll(".mktoError");o.forEach(e=>{e.style.opacity="0",setTimeout(()=>e.remove(),300)}),e.querySelectorAll(".customInvalid").forEach(e=>{e.classList.remove("customInvalid","mktoInvalid")}),e.removeEventListener("click",t)};e.addEventListener("click",t)}markValid(e){e.classList.remove("customInvalid","mktoInvalid"),e.classList.add("mktoValid"),e.setAttribute("aria-invalid","false"),MktoForms2.$(e).siblings(".mktoError").remove(),this.options.debug&&console.log(`Validation passed for ${e.name}`)}markInvalid(e,t){e.classList.add("customInvalid","mktoInvalid"),e.classList.remove("mktoValid"),e.setAttribute("aria-invalid","true");let o=e.parentElement.querySelector(".mktoError");o&&o.remove();let i=document.createElement("div");i.classList.add("mktoError"),i.style.opacity="0",i.style.transition="opacity 0.3s ease-in-out";let s=document.createElement("div");s.classList.add("mktoErrorArrowWrap");let l=document.createElement("div");l.classList.add("mktoErrorArrow");let r=document.createElement("div");r.classList.add("mktoErrorMsg"),r.setAttribute("id","ValidMsgTitle"),r.setAttribute("role","alert"),r.setAttribute("tabindex","-1"),r.textContent=t,s.appendChild(l),i.appendChild(s),i.appendChild(r),e.parentElement.appendChild(i),requestAnimationFrame(()=>{e.getBoundingClientRect(),i.getBoundingClientRect(),i.style.position="absolute",i.style.top=`${e.offsetTop+e.offsetHeight+5}px`,i.style.left=`${e.offsetLeft+e.offsetWidth/2}px`,i.style.transform="translateX(-50%)",i.style.zIndex="10",requestAnimationFrame(()=>{i.style.opacity="1"}),this.options.debug&&console.warn(`Validation failed: ${t}`)}),this.setupErrorHideEvents()}hideSpecifiedElements(e){let t=e.getFormElem()[0];if(this.options.hideFields&&Array.isArray(this.options.hideFields)&&this.options.hideFields.forEach(e=>{let o=t.querySelector(`[name="${e}"]`);if(o){let i=o.closest(".mktoFormRow");i&&(i.classList.add("oto-hidden"),this.options.debug&&console.log(`‚ö°Ô∏è Hiding row for field: ${e}`))}else this.options.debug&&console.warn(`Field not found for hiding: ${e}`)}),this.options.hideFieldsets&&Array.isArray(this.options.hideFieldsets)&&this.options.hideFieldsets.forEach(e=>{let o=t.querySelectorAll("legend");o.forEach(t=>{if(t.textContent.trim().toLowerCase()===e.toLowerCase()){let o=t.closest(".mktoFormRow");o&&(o.classList.add("oto-hidden"),this.options.debug&&console.log(`‚ö°Ô∏è Hiding fieldset with legend: "${e}"`))}})}),this.options.hideLegends){let o=t.querySelectorAll("legend");o.forEach(e=>{e&&(e.classList.add("oto-hidden"),this.options.debug&&console.log(`‚ö°Ô∏è Hiding legend: "${e.textContent.trim()}"`))})}}hideLabelsForFields(e){if(!this.options.hideLabels||!Array.isArray(this.options.hideLabels))return;let t=e.getFormElem()[0];this.options.hideLabels.forEach(e=>{let o;switch(e){case"text":case"url":case"number":case"email":case"tel":case"date":case"textarea":o=`input[type="${e}"], textarea`,t.querySelectorAll(o).forEach(e=>{this.hideLabelForInput(e)});break;case"select":o="select",t.querySelectorAll(o).forEach(e=>{this.hideLabelForInput(e)});break;case"checkboxlist":t.querySelectorAll(".mktoCheckboxList").forEach(e=>{this.hideAssociatedLabel(e)});break;case"radiolist":t.querySelectorAll(".mktoRadioList").forEach(e=>{this.hideAssociatedLabel(e)});break;default:return}})}hideLabelForInput(e){let t=e.id?document.querySelector(`label[for="${e.id}"]`):null;t&&(t.classList.add("visually-hidden"),this.options.debug&&console.log(`‚ö°Ô∏è Hiding label for input:`,e.name))}hideAssociatedLabel(e){let t=e.querySelector("input");if(!t||!t.name)return;let o=e.closest(".mktoFieldWrap")?.querySelector(`label[for="${t.name}"]`);o&&(o.classList.add("visually-hidden"),this.options.debug&&console.log(`‚ö°Ô∏è Hiding label for list with name:`,t.name))}setupHoneypotValidation(e){return new Promise(t=>{let o=this.options.honeypot;if(!o)return t(!0);let i=e.getFormElem()[0],s=i.querySelector(`[name="${o}"]`);if(!s)return this.options.debug&&console.warn(`‚ö†Ô∏è Honeypot field not found: ${o}`),t(!0);""===s.value.trim()?(this.options.debug&&console.log("‚úÖ Honeypot validation passed (empty field)."),t(!0)):(this.options.debug&&console.warn("\uD83D\uDEA8 Honeypot triggered! Submission blocked."),t(!1))})}setupNotYouButton(){if(!this.options.notYou||!this.options.notYouHtml||!this.options.notYouAfterElem)return;let e=document.querySelector(this.options.notYouAfterElem);if(!e){this.options.debug&&console.warn(`‚ö†Ô∏è Target element for "Not You?" not found: ${this.options.notYouAfterElem}`);return}let t=document.createElement("div");t.innerHTML=this.options.notYouHtml,e.insertAdjacentElement("afterend",t),this.options.debug&&console.log(`‚ö°Ô∏è Injected "Not You?" button after: ${this.options.notYouAfterElem}`);let o=document.querySelector("#not-you-button");o&&o.addEventListener("click",e=>{e.preventDefault(),this.notYouHandler()})}notYouHandler(){this.options.debug&&console.log("‚ö°Ô∏è Not You? button clicked. Clearing Marketo tracking cookie."),FormsPlus.util.DNS.climbDomains([],e=>{FormsPlus.util.Cookies.remove(FormsPlus.strings.MARKETO_TRACKING_COOKIE,{domain:e,path:"/"})});let e=new FormsPlus.util.URI.URI;e.removeSearch([FormsPlus.strings.MARKETO_EMAIL_ASSOCIATOR_TOKEN,FormsPlus.strings.MARKETO_FORM_DATA_CACHE]),document.location.href=e}refactorNumberInputs(e){if(!this.options.numberRefactore||!this.options.numberRefactoreItems)return;let t=e.getFormElem()[0];Object.entries(this.options.numberRefactoreItems).forEach(([e,o])=>{let i=t.querySelector(`input[name="${e}"][type="number"]`);if(!i){this.options.debug&&console.warn(`‚ö†Ô∏è Number input "${e}" not found.`);return}let s="any"===o?"any":parseFloat(o)||1,l=i.getAttribute("min")||"",r=i.getAttribute("max")||"",n=i.value||"",a=document.createElement("span");a.classList.add("oto-num-stepper");let d=document.createElement("button");d.setAttribute("type","button"),d.textContent="‚àí",d.addEventListener("click",()=>this.stepperInput(i,-s,l));let c=document.createElement("button");c.setAttribute("type","button"),c.textContent="+",c.addEventListener("click",()=>this.stepperInput(i,s,r)),i.setAttribute("step",s),i.setAttribute("min",l),i.setAttribute("max",r),i.setAttribute("readonly","true"),i.value=n,i.parentNode.insertBefore(a,i),a.appendChild(d),a.appendChild(i),a.appendChild(c),this.options.debug&&console.log(`‚úÖ Refactored number input "${e}" with step ${s}.`)})}stepperInput(e,t,o){let i=parseFloat(e.value)||0;"any"===e.getAttribute("step")||parseFloat(e.getAttribute("step"));let s=e.getAttribute("min")?parseFloat(e.getAttribute("min")):-1/0,l=e.getAttribute("max")?parseFloat(e.getAttribute("max")):1/0,r=i+t;r<s&&(r=s),r>l&&(r=l),e.value=r}processRadioOptions(){let e=document.querySelector(".mktoForm");if(e){if(!this.options.radios||Array.isArray(this.options.radios)&&0===this.options.radios.length){e.querySelectorAll(".mktoRadioList").forEach(e=>{e.classList.contains("otoform-default-radios")||e.classList.add("otoform-default-radios")}),this.options.debug&&console.warn("‚ö†Ô∏è No specific radio configurations found. Applied 'otoform-default-radios' to all radio lists.");return}Object.keys(this.options.radios).forEach(t=>{let o=this.options.radios[t],i=e.querySelectorAll(`input[name="${t}"]`);if(0===i.length){this.options.debug&&console.warn(`‚ö†Ô∏è No radios found for group: ${t}`);return}i.forEach(e=>{let i=e.closest(".mktoRadioList");i&&(o.style||o.inline||i.classList.add("otoform-default-radios"),o.inline&&i.classList.add("otoform-inline-radios"),"tabs"===o.style?i.classList.add("otoform-tabs-radios"):"square"===o.style?i.classList.add("otoform-square-radios"):i.classList.add("otoform-default-radios"),this.options.debug&&console.log(`‚ö°Ô∏è Processed radio group "${t}" with style: ${o.style||"default"}`))})})}}processCheckboxOptions(){let e=document.querySelector(".mktoForm");if(e){if(!this.options.checkBoxes||Array.isArray(this.options.checkBoxes)&&0===this.options.checkBoxes.length){e.querySelectorAll(".mktoCheckboxList").forEach(e=>{e.classList.contains("otoform-default-checkboxes")||e.classList.add("otoform-default-checkboxes")}),this.options.debug&&console.warn("‚ö†Ô∏è No specific checkbox configurations found. Applied 'otoform-default-checkboxes' to all checkbox lists.");return}Object.keys(this.options.checkBoxes).forEach(t=>{let o=this.options.checkBoxes[t],i=e.querySelectorAll(`input[name="${t}"]`);if(0===i.length){this.options.debug&&console.warn(`‚ö†Ô∏è No checkboxes found for group: ${t}`);return}i.forEach(e=>{let i=e.closest(".mktoCheckboxList");i&&(o.style||o.inline||o.behavior||i.classList.add("otoform-default-checkboxes"),o.inline&&i.classList.add("otoform-inline-checkboxes"),"round"===o.style||"square"===o.style?this.initSwitches(e,o.style):i.classList.add("otoform-default-checkboxes"),"actAsRadio"===o.behavior&&this.initializeCheckboxGroupAsRadio(t))})})}}initSwitches(e,t){let o=e.closest(".mktoCheckboxList");if(!o)return;o.classList.contains("otoform-switches")?o.classList.add("otoform-classic"):o.classList.add("otoform-switches");let i=document.createElement("label");i.classList.add("otoform-switch"),e.parentNode.insertBefore(i,e),i.appendChild(e);let s=document.createElement("span");s.classList.add("otoform-slider",`otoform-slider-${t}`),i.appendChild(s),this.options.debug&&console.log(`Applied ${t} switch styling to checkbox:`,e.name)}initializeCheckboxGroupAsRadio(e){let t=document.querySelectorAll(`input[name="${e}"]`);if(0===t.length)return;t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>{t!==e&&(t.checked=!1)})})});let o=Array.from(t).find(e=>e.checked);o&&t.forEach(e=>{e!==o&&(e.checked=!1)}),this.options.debug&&console.log(`Initialized radio-like behavior for checkbox group: ${e}`)}replaceTokensInForm(e){if(!this.options.updateTokens||"object"!=typeof this.options.updateTokens)return;let t=e.getFormElem()[0],o=t.querySelectorAll("*:not(script):not(style)");o.forEach(e=>{Object.keys(this.options.updateTokens).forEach(t=>{let o=this.options.updateTokens[t];1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE&&e.textContent.includes(t)&&(e.textContent=e.textContent.replace(t,o),this.options.debug&&console.log(`Replaced token "${t}" in element:`,e)),e.hasAttribute("value")&&e.getAttribute("value").includes(t)&&(e.setAttribute("value",e.getAttribute("value").replace(t,o)),this.options.debug&&console.log(`Replaced token "${t}" in input value:`,e)),e.hasAttribute("placeholder")&&e.getAttribute("placeholder").includes(t)&&(e.setAttribute("placeholder",e.getAttribute("placeholder").replace(t,o)),this.options.debug&&console.log(`Replaced token "${t}" in placeholder:`,e))})})}initCustomLabels(e){if(!this.options.customLabels||"object"!=typeof this.options.customLabels)return;let t=e.getFormElem()[0];Object.entries(this.options.customLabels).forEach(([e,o])=>{if(!e||!o)return;let i=t.querySelector(`label[for="${e}"]`);i?(i.innerHTML=o,this.options.debug&&console.log(`Updated label for "${e}" with custom content.`)):this.options.debug&&console.warn(`Label with for="${e}" not found.`)})}applyTranslations(e){if(!this.options.translate||"json"!==this.options.translate)return;let t=document.documentElement.lang||"en",o=`${this.options.translateJson.folder}${t}.json`;this.options.debug&&console.log(`Loading translations from: ${o}`),fetch(o).then(e=>e.json()).then(e=>{Object.keys(e).forEach(t=>{let o=document.querySelectorAll(t);o.forEach(o=>{!["INPUT","TEXTAREA"].includes(o.tagName)&&(o.textContent=e[t],this.options.debug&&console.log(`Translated ${t} ‚Üí "${e[t]}"`)),o.hasAttribute("placeholder")&&e[t].placeholder&&(o.setAttribute("placeholder",e[t].placeholder),this.options.debug&&console.log(`Translated placeholder for ${t} ‚Üí "${e[t].placeholder}"`))})}),this.options.debug&&console.log(`Translations applied for language: ${t}`)}).catch(e=>{console.error(`Failed to load translations: ${e}`)})}cleanUpMktoElements(e){if(!Array.isArray(this.options.removeElems)||0===this.options.removeElems.length)return;let t=e.getFormElem()[0];this.options.removeElems.forEach(e=>{let o=t.querySelectorAll(e);o.forEach(e=>e.remove()),this.options.debug&&o.length&&console.log(`Removed ${o.length} elements matching: "${e}"`)})}processUrlParams(e){if(!this.options.urlParamsToHiddenFields)return;let t=this.options.urlParamsToHiddenFieldsConfig;if(!t||"object"!=typeof t)return;let o=e.getFormElem()[0],i=new URLSearchParams(window.location.search),s={};Object.entries(t.mapping).forEach(([e,o])=>{if(t.excludeList.includes(e))return;let l=null;if(t.cookiesFirst&&t.cookiesFirst.prefix){let r=`${t.cookiesFirst.prefix}${e}`;l=this.getCookie(r)}l||(l=i.get(e)),l&&(s[o]=l)}),Object.entries(s).forEach(([e,t])=>{let i=o.querySelector(`input[name="${e}"]`);i||((i=document.createElement("input")).type="hidden",i.name=e,o.appendChild(i)),i.value=t,this.options.debug&&console.log(`Set hidden field "${e}" with value: ${t}`)})}setupToggleDisabling(e){let t=e.getFormElem()[0];this.options.radios&&Object.keys(this.options.radios).forEach(e=>{let o=this.options.radios[e];if("toggleDisabling"!==o.behavior)return;let i=t.querySelectorAll(`input[name="${e}"]`);if(!i.length)return;let s=Array.from(i).find(e=>e.value===o.relations.yesValue),l=Array.from(i).find(e=>e.value===o.relations.noValue),r=t.querySelectorAll(`input[name="${o.relations.targetCheckboxList}"]`);if(!s||!l||!r.length)return;let n=e=>{r.forEach(t=>{t.disabled=e,e&&(t.checked=!1)})};n(l.checked),s.addEventListener("change",()=>n(!1)),l.addEventListener("change",()=>n(!0))}),this.options.checkBoxes&&Object.keys(this.options.checkBoxes).forEach(e=>{let o=this.options.checkBoxes[e];if("toggleDisabling"!==o.behavior)return;let i=t.querySelectorAll(`input[name="${e}"]`);if(!i.length)return;let s=Array.from(i).find(e=>e.value===o.relations.fullDayValue),l=i.filter(e=>o.relations.disableOnChecked.includes(e.value));if(!s||!l.length)return;let r=e=>{l.forEach(t=>{t.disabled=e,e&&(t.checked=!1)})};r(s.checked),s.addEventListener("change",()=>{r(s.checked)})})}slugify(e){return e.toLowerCase().replace(/[\s]+/g,"-").replace(/[^\w-]+/g,"")}getCookie(e){let t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}async sha256(e){let t=new TextEncoder,o=t.encode(e),i=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")}async pushToDataLayer(e,t={}){if(!this.options.dataLayerTracking||!this.options.dataLayerConfig)return;if(!this.form){console.warn("‚ö†Ô∏è pushToDataLayer: Form is not initialized yet.");return}let o=this.options.dataLayerConfig;if(!e)return;window.dataLayer=window.dataLayer||[];let i={event:e,formID:this.formID};if(o.additionalData.includeReferrer&&(i.requestReferrerUrl=document.referrer||window.location.href),o.additionalData.includeUserEmail){let s=this.form.getFormElem()[0],l=s.querySelector(`input[name="${o.additionalData.includeUserEmail}"]`);if(l&&l.value){let r=l.value.trim().toLowerCase();o.additionalData.hashEmail?i.userEmailHashed=await this.sha256(r):i.userEmail=r}}Object.assign(i,t),window.dataLayer.push(i),this.options.debug&&console.log(`DataLayer Event: ${e}`,i)}executeCustomBehaviorsOnFormReady(e){this.options.customBehaviorsOnFormReady&&"object"==typeof this.options.customBehaviorsOnFormReady&&Object.keys(this.options.customBehaviorsOnFormReady).forEach(t=>{let o=this.options.customBehaviorsOnFormReady[t];"function"==typeof o?(this.options.debug&&console.log(`üîπ Executing custom behavior On Form Ready: ${t}`),o(e)):console.warn(`‚ö†Ô∏è Custom On Form Ready behavior "${t}" is not a function.`)})}executeCustomBehaviorsOnFormSuccess(e){this.options.customBehaviorsOnFormSuccess&&"object"==typeof this.options.customBehaviorsOnFormSuccess&&Object.keys(this.options.customBehaviorsOnFormSuccess).forEach(t=>{let o=this.options.customBehaviorsOnFormSuccess[t];"function"==typeof o?(this.options.debug&&console.log(`üîπ Executing custom behavior On Form Success: ${t}`),o(e)):console.warn(`‚ö†Ô∏è Custom On Form Success behavior "${t}" is not a function.`)})}executeCustomBehaviorsOnFormPrefill(e){this.options.customBehaviorsOnFormPrefill&&"object"==typeof this.options.customBehaviorsOnFormPrefill&&Object.keys(this.options.customBehaviorsOnFormPrefill).forEach(t=>{let o=this.options.customBehaviorsOnFormPrefill[t];"function"==typeof o?(this.options.debug&&console.log(`üîπ Executing custom behavior On Form Prefill: ${t}`),o(e)):console.warn(`‚ö†Ô∏è Custom On Form Prefill behavior "${t}" is not a function.`)})}}